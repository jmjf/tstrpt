# RPT5

Let's start by building a list of files based on enqueues.

If the enqueue's `data.nesting` is 0 and it has no `data.file`, then `data.name` is the file name. Otherwise, it's a test or suite within a file.

Add a function to build a summary output showing files that were run.

For enqueues that don't meet file criteria, add as a test.

In the summary function, sort tests by file and line number and print with indenting based on nesting.

NEXT:

- when a test is a child of another test, flag the parent started.
- when a test in a file is started, flag the file started.
- when a test passes, flag it passed and set run time.

## Finding the parent of a test

Assume I have the following

-- TEST A -- nesting 0
----- TEST B -- nesting 1
----- TEST C -- nesting 2
-------- TEST D -- nesting 3
----- TEST E -- nesting 4

A parent test must:

- Be in the same file as the child test (same fileIdx).
- Have nesting one less than the child test's nesting.
- Start on a line before the child test. (Can use NTR's line, even though it isn't right for TS, it is relatively right.)

If I filter tests by fileIdx and nesting and line number less than the child test, then if I sort by line number, the last test is the parent.

The issue is, I need the index of that test in the original array and filter will lose it. Sorting will also change the index.

The easiest answer may be to store index in the test object, which is just `array.length || 0`. Then I can get the index from the object even after filtering and sorting.

So, with index in the test object, filter by fileIdx, nesting, and line number. Then reduce to find the max test line.

And that's working. There may be a better way to do this if I smart-key the tests or group them by file so the array operations are over smaller arrays, but that's probably only an issue for large test sets.

For example, I could build a `Map` by file name and store the test array for each file separately, but that seems like it might introduce other inefficiencies because I'd need to look up the array, update it, and set it every time I wanted to change it.

